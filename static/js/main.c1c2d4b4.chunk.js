(this["webpackJsonpar-test"]=this["webpackJsonpar-test"]||[]).push([[0],{14:function(e,t,r){e.exports=r(32)},19:function(e,t,r){},29:function(e,t,r){},30:function(e,t,r){},31:function(e,t,r){},32:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r.n(a),o=r(5),i=r.n(o),c=r(3),s=r(10),u=r.n(s),l=r(0),d=r(11),m=r(4),h=window.artoolkit,f=0;function p(e,t,r){this.id=f++,this.context=e,this.object3d=t,this.object3d.matrixAutoUpdate=!1,this.object3d.visible=!1,this.parameters=Object(m.a)({size:1,type:"unknown",patternUrl:null,barcodeValue:null,changeMatrixMode:"modelViewMatrix",minConfidence:.6},r),e.addMarker(this),this._initArtoolkit()}Object.assign(p.prototype,l.n.prototype),p.prototype.dispose=function(){this.context.removeMarker(this)},p.prototype.updateWithModelViewMatrix=function(e){var t=this.object3d;t.visible=!0;var r=(new l.I).copy(this.context._artoolkitProjectionAxisTransformMatrix),a=(new l.I).makeRotationX(Math.PI/2);r.multiply(e),r.multiply(a),e.copy(r),"modelViewMatrix"===this.parameters.changeMatrixMode?t.matrix.copy(e):"cameraTransformMatrix"===this.parameters.changeMatrixMode&&t.matrix.getInverse(e),t.matrix.decompose(t.position,t.quaternion,t.scale),this.dispatchEvent({type:"markerPositionUpdated",data:t.matrix.toArray()})},p.prototype.name=function(){var e=this.parameters,t=e.type,r=e.patternUrl,a=e.barcodeValue;return"pattern"===t?"".concat(t,"-").concat(r.replace(/^.*\//g,"")):"barcode"===t?"".concat(t,"-").concat(a):t},p.prototype._initArtoolkit=function(){var e=this,t=this.parameters,r=t.size,a=t.type,n=t.patternUrl,o=t.barcodeValue,i=t.minConfidence,c=this.context.arController,s=null;"pattern"===a?c.loadMarker(n,(function(e){s=e,c.trackPatternMarkerId(s,r)})):"barcode"===a&&(s=o,c.trackBarcodeMarkerId(s,r)),c.addEventListener("getMarker",(function(t){var r=t.data,n=r.type,o=r.marker,c=r.matrix;(n===h.PATTERN_MARKER&&"pattern"===a&&o.idPatt===s&&o.cfPatt>i||n===h.BARCODE_MARKER&&"barcode"===a&&o.idMatrix===s&&o.cfMatt<i)&&e.updateWithModelViewMatrix((new l.I).fromArray(c))}))};var v=p,b=window,w=b.artoolkit,g=b.ARController,x=b.ARCameraParam,M={color:w.AR_TEMPLATE_MATCHING_COLOR,color_and_matrix:w.AR_TEMPLATE_MATCHING_COLOR_AND_MATRIX,mono:w.AR_TEMPLATE_MATCHING_MONO,mono_and_matrix:w.AR_TEMPLATE_MATCHING_MONO_AND_MATRIX},_={"3x3":w.AR_MATRIX_CODE_3x3,"3x3_HAMMING63":w.AR_MATRIX_CODE_3x3_HAMMING63,"3x3_PARITY65":w.AR_MATRIX_CODE_3x3_PARITY65,"4x4":w.AR_MATRIX_CODE_4x4,"4x4_BCH_13_9_3":w.AR_MATRIX_CODE_4x4_BCH_13_9_3,"4x4_BCH_13_5_5":w.AR_MATRIX_CODE_4x4_BCH_13_5_5};function E(e){this._updatedAt=null,this.arController=null,this._arMarkersControls=[],this._artoolkitProjectionAxisTransformMatrix=new l.I,this._artoolkitProjectionAxisTransformMatrix.multiply((new l.I).makeRotationY(Math.PI)),this._artoolkitProjectionAxisTransformMatrix.multiply((new l.I).makeRotationZ(Math.PI)),this.parameters=Object(m.a)({detectionMode:"mono",matrixCodeType:"3x3",cameraParametersUrl:"parameters/camera_para.dat",maxDetectionRate:60,canvasWidth:640,canvasHeight:480,patternRatio:.5,imageSmoothingEnabled:!1},e)}Object.assign(E.prototype,l.n.prototype),E.prototype.update=function(e){if(null===this.arController)return!1;var t=performance.now();return!(null!==this._updatedAt&&t-this._updatedAt<1e3/this.parameters.maxDetectionRate)&&(this._updatedAt=t,this._arMarkersControls.forEach((function(e){e.object3d.visible=!1})),this.arController.process(e),!0)},E.prototype.addMarker=function(e){this._arMarkersControls.push(e)},E.prototype.removeMarker=function(e){var t=this._arMarkersControls.findIndex((function(t){return t.id===e.id}));this._arMarkersControls.splice(t,1)},E.prototype.init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},r=this.parameters,a=r.cameraParametersUrl,n=r.canvasWidth,o=r.canvasHeight,i=r.imageSmoothingEnabled,c=r.detectionMode,s=r.matrixCodeType,u=r.patternRatio,l=new x(a,(function(){var r=new g(n,o,l);e.arController=r,r.ctx.mozImageSmoothingEnabled=i,r.ctx.webkitImageSmoothingEnabled=i,r.ctx.msImageSmoothingEnabled=i,r.ctx.imageSmoothingEnabled=i,r.setPatternDetectionMode(M[c]),r.setMatrixCodeType(_[s]),r.setPattRatio(u),t()}));return this},E.prototype.getProjectionMatrix=function(){var e=this.arController.getCameraMatrix(),t=(new l.I).fromArray(e);return t.multiply(this._artoolkitProjectionAxisTransformMatrix),t};var y=E,R=r(12),A=r.n(R),j=(r(19),function(e){var t=e.width,r=e.height,a=e.style,o=e.fillColor,i=e.isActive,c=e.className;return n.a.createElement("svg",{style:a,width:t,height:r,"aria-hidden":"true",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:A()(c,i&&"sound-wave--active")},n.a.createElement("g",{fill:o},n.a.createElement("rect",{className:"sound-wave-bar sound-wave-bar-1",x:"4.9",rx:"1.5"}),n.a.createElement("rect",{className:"sound-wave-bar sound-wave-bar-2",x:"13.5",rx:"1.5"}),n.a.createElement("rect",{className:"sound-wave-bar sound-wave-bar-3",x:"22.1",rx:"1.5"}),n.a.createElement("rect",{className:"sound-wave-bar sound-wave-bar-2",x:"30.7",rx:"1.5"}),n.a.createElement("rect",{className:"sound-wave-bar sound-wave-bar-1",x:"39.5",rx:"1.5"})))});j.defaultProps={width:"24",height:"24",fillColor:"#fff"};var O=j,C=function(e){var t=e.width,r=e.height,a=e.style,o=e.strokeColor,i=e.isMute;return n.a.createElement("svg",{style:a,width:t,height:r,"aria-hidden":"true",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},n.a.createElement("g",{transform:"translate(1, 3)",stroke:o,strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},n.a.createElement("path",{d:"M5.57,6.06 L1.25,6.06 C0.84,6.06 0.5,6.4 0.5,6.8 L0.5,11.36 C0.5,11.78 0.84,12.12 1.25,12.12 L5.57,12.12 C6.7,15.03 9.34,17.06 12.43,17.38 C12.64,17.4 12.85,17.33 13,17.18 C13.16,17.04 13.25,16.84 13.25,16.62 L13.25,1.55 C13.25,1.34 13.16,1.13 13,1 C12.85,0.85 12.64,0.78 12.43,0.8 C9.34,1.11 6.7,3.15 5.57,6.06 Z"}),i?n.a.createElement(n.a.Fragment,null,n.a.createElement("line",{x1:"21.32",y1:"7",x2:"17",y2:"11.5"}),n.a.createElement("line",{x1:"17",y1:"7",x2:"21.32",y2:"11.5"})):n.a.createElement(n.a.Fragment,null,n.a.createElement("path",{d:"M20.46,12.67 C21.85,10.49 21.85,7.69 20.46,5.5"}),n.a.createElement("path",{d:"M17.56,11.357 C18.6,10.06 18.6,8.2 17.56,6.9"}))))};C.defaultProps={width:"24",height:"24",strokeColor:"#fff"};var k=C,I=r(13),P=r.n(I),T=function(){var e=function(){return{width:window.innerWidth,height:window.innerHeight}},t=Object(a.useState)(e),r=Object(c.a)(t,2),n=r[0],o=r[1];return Object(a.useEffect)((function(){var t=P()((function(){o(e())}),50);return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[]),n},N=function(e,t){var r=T(),a=r.width,n=r.height,o=a/n,i={display:"none",width:a,height:n,marginTop:0,marginLeft:0};if(e){var c=t.current,s=c.videoWidth/c.videoHeight;if(o<s){var u=s*n;i={height:n,width:u,marginTop:0,marginLeft:-(u-a)/2}}else{var l=a/s;i={width:a,height:l,marginTop:-(l-n)/2,marginLeft:0}}}return{videoStyles:i,canvasStyles:Object(m.a)(Object(m.a)({position:"absolute",top:0,left:0},i),o<1?{width:4*i.height/3,marginLeft:(a-4*i.height/3)/2}:{})}},L=function(e){var t=e.sourceWidth,r=e.sourceHeight,i=e.canvasRef,s=e.videoSourceRef,u=Object(a.useRef)(),l=Object(a.useState)(!1),d=Object(c.a)(l,2),m=d[0],h=d[1],f=N(m,u),p=f.videoStyles,v=f.canvasStyles;return Object(a.useEffect)((function(){var e=!0,t=function(){u.current.play()};return navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{min:640,max:640},height:{min:480,max:480}}}).then((function(r){if(e){u.current.srcObject=r,document.body.addEventListener("click",t);var a=setInterval((function(){u.current&&u.current.videoWidth&&(h(!0),clearInterval(a))}),20)}})).catch((function(e){console.log(e)})),function(){e=!1,document.body.removeEventListener("click",t),u.current.srcObject&&u.current.srcObject.getTracks().forEach((function(e){return e.stop()}))}}),[t,r]),Object(o.createPortal)(n.a.createElement(n.a.Fragment,null,n.a.createElement("video",{muted:!0,autoPlay:!0,playsInline:!0,ref:function(e){u.current=e,s.current=e},style:p}),n.a.createElement("canvas",{ref:i,width:t,height:r,style:v})),document.getElementById("ar-container"))};L.defaultProps={sourceWidth:640,sourceHeight:480,canvasRef:{},videoSourceRef:{}};var S=L,U=(r(29),function(e){var t=e.initialScale,r=e.patternUrl,o=e.cameraParametersUrl,i=e.modelUrl,s=e.audioUrl,m=Object(a.useRef)(),h=Object(a.useRef)(),f=Object(a.useRef)(),p=Object(a.useRef)(),b=Object(a.useRef)(),w=Object(a.useRef)(),g=Object(a.useRef)(),x=Object(a.useRef)(),M=Object(a.useRef)(),_=Object(a.useRef)(),E=Object(a.useRef)({eventRotation:0,modelRotation:0}),R=Object(a.useState)(!1),A=Object(c.a)(R,2),j=A[0],C=A[1],I=Object(a.useState)(!1),P=Object(c.a)(I,2),T=P[0],N=P[1],L=Object(a.useState)(!1),U=Object(c.a)(L,2),H=U[0],D=U[1],W=Object(a.useState)(!1),B=Object(c.a)(W,2),V=B[0],X=B[1];return Object(a.useEffect)((function(){H&&T?m.current.play():m.current.pause()}),[H,T]),Object(a.useEffect)((function(){var e=t/3,r=3*t;return b.current=new u.a(document.getElementById("ar-container")),b.current.get("pan").set({enable:!1}),b.current.get("pinch").set({enable:!0}),b.current.get("rotate").set({enable:!0}),b.current.on("pinchstart",(function(e){h.current&&(_.current=h.current.scene.scale.x)})),b.current.on("pinch",(function(t){if(_.current&&h.current){var a=_.current*t.scale,n=Math.min(Math.max(a,e),r);h.current.scene.scale.set(n,n,n)}})),b.current.on("rotatestart",(function(e){h.current&&(E.current={modelRotation:h.current.scene.rotation.y,eventRotation:e.rotation})})),b.current.on("rotate",(function(e){if(h.current){var t=(e.rotation-E.current.eventRotation)/180*Math.PI;h.current.scene.rotation.y=E.current.modelRotation-t}})),function(){b.current.destroy()}}),[t]),Object(a.useEffect)((function(){var e=0,t=!0,a=!1,n=640,i=480,c=new l.j,s=new l.h,u=new l.pb({canvas:w.current,antialias:!0,alpha:!0}),d=new y({cameraParametersUrl:o,detectionMode:"mono",canvasWidth:n,canvasHeight:i});g.current=new l.q,f.current=new l.db,f.current.add(s),f.current.add(g.current),u.setClearColor(new l.k("lightgrey"),0),u.setPixelRatio(window.devicePixelRatio),d.init((function(){s.projectionMatrix.copy(d.getProjectionMatrix()),new v(d,g.current,{type:"pattern",patternUrl:r})}));return function r(){t&&(requestAnimationFrame(r),e=c.getDelta(),a!==g.current.visible&&(a=g.current.visible,D(g.current.visible),M.current&&(M.current.paused=!a)),p.current&&p.current.update(e),x.current&&d.update(x.current),u.render(f.current,s))}(),function(){t=!1}}),[o,r]),Object(a.useEffect)((function(){return(new d.a).load(i,(function(e){h.current=e;var r=e.scene,a=new l.a(16777215,2),n=new l.V(16777215,1,0,2),o=new l.V(16777215,1,0,2);if(g.current.add(a),n.position.set(0,1,1),g.current.add(n),o.position.set(0,1,-1),g.current.add(o),r.scale.set(t,t,t),g.current.add(r),e.animations[0]){var i=e.animations[0];p.current=new l.c(r),M.current=p.current.clipAction(i),M.current.loop=l.F,M.current.clampWhenFinished=!0,M.current.play(),M.current.paused=!g.current.visible,p.current.addEventListener("finished",(function(e){X(!0)}))}N(!0)})),function(){N(!1),X(!1),g.current.children=[],p.current=null,M.current=null}}),[i,t]),n.a.createElement("div",null,n.a.createElement(S,{canvasRef:w,videoSourceRef:x}),n.a.createElement("div",{className:"ar-icons-overlay"}),n.a.createElement("audio",{loop:!0,ref:m,preload:"auto"},n.a.createElement("source",{src:s,type:"audio/mpeg"})),n.a.createElement("button",{className:"ar-icon ar-icon-sound",onClick:function(){C(!j),m.current.volume=j?1:0}},n.a.createElement(k,{width:32,height:32,isMute:j})),n.a.createElement(O,{width:32,height:32,isActive:H,className:"ar-icon ar-icon-wave"}),!T&&n.a.createElement("div",{className:"ar-loading"},"Loading AR model..."),V&&H&&n.a.createElement("button",{className:"ar-loading",onClick:function(){X(!1),M.current.reset(),M.current.play()}},"Replay animation!"))});U.defaultProps={initialScale:4e-4,audioUrl:"".concat("/ar-test","/audio/anchor.mp3"),modelUrl:"".concat("/ar-test","/models/anchor/model.gltf"),patternUrl:"".concat("/ar-test","/data/hiro.patt"),cameraParametersUrl:"".concat("/ar-test","/data/camera_para.dat")};var H=U;r(30);var D=function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),r=t[0],o=t[1];return n.a.createElement("div",{className:"App"},n.a.createElement("button",{className:"App-button",onClick:function(){return o((function(e){return!e}))}},r?"Disable":"Enable"," AR"),r&&n.a.createElement(H,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(31);i.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[14,1,2]]]);
//# sourceMappingURL=main.c1c2d4b4.chunk.js.map